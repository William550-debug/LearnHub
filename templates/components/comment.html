<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<!-- Comment Component -->
<div class="comment border-b border-gray-200 pb-6 mb-6" data-comment-id="{{ comment.id }}">
    <div class="flex items-start mb-4">
        <!-- User Avatar -->
        <a href="/profile/{{ comment.author.username }}/" class="flex-shrink-0">
            <div class="w-10 h-10 rounded-full {{ comment.author.avatar_bg }} flex items-center justify-center">
                <span class="{{ comment.author.avatar_text }} font-medium">{{ comment.author.initials }}</span>
            </div>
        </a>

        <!-- Comment Content -->
        <div class="ml-4 flex-1">
            <!-- Comment Header -->
            <div class="flex flex-wrap items-center justify-between mb-2">
                <div>
                    <a href="/profile/{{ comment.author.username }}/" class="font-bold hover:text-indigo-600">
                        {{ comment.author.name }}
                    </a>
                    {% if comment.author.verified %}
                    <span class="ml-2 text-xs px-2 py-0.5 bg-blue-100 text-blue-800 rounded-full">
                        <i class="fas fa-check-circle text-xs"></i> Verified
                    </span>
                    {% endif %}
                    <span class="text-gray-500 text-sm ml-2">{{ comment.time_ago }}</span>

                    {% if comment.edited %}
                    <span class="text-gray-400 text-sm ml-1">(edited)</span>
                    {% endif %}
                </div>

                <!-- Rating Stars -->
                {% if comment.rating > 0 %}
                <div class="flex items-center text-yellow-400">
                    {% for i in range(1, 6) %}
                        {% if i <= comment.rating %}
                        <i class="fas fa-star text-sm"></i>
                        {% elif i == comment.rating + 0.5 %}
                        <i class="fas fa-star-half-alt text-sm"></i>
                        {% else %}
                        <i class="far fa-star text-sm"></i>
                        {% endif %}
                    {% endfor %}
                </div>
                {% endif %}
            </div>

            <!-- Comment Text -->
            <div class="comment-text">
                <p class="text-gray-700">{{ comment.content }}</p>

                <!-- Edited Content (if any) -->
                {% if comment.edited_content %}
                <div class="mt-3 p-3 bg-gray-50 border-l-4 border-gray-300 rounded-r">
                    <p class="text-sm text-gray-600 mb-1">
                        <i class="fas fa-history mr-1"></i> Originally:
                    </p>
                    <p class="text-gray-600 text-sm italic">{{ comment.original_content }}</p>
                </div>
                {% endif %}
            </div>

            <!-- Comment Actions -->
            <div class="mt-4 flex items-center space-x-4 text-gray-500">
                <!-- Like Button -->
                <button class="like-btn flex items-center hover:text-indigo-600" data-liked="{{ comment.user_liked }}">
                    {% if comment.user_liked %}
                    <i class="fas fa-thumbs-up text-indigo-600 mr-1"></i>
                    {% else %}
                    <i class="far fa-thumbs-up mr-1"></i>
                    {% endif %}
                    <span class="like-count text-sm font-medium">{{ comment.likes }}</span>
                </button>

                <!-- Reply Button -->
                <button class="reply-btn hover:text-indigo-600 text-sm font-medium">
                    Reply
                </button>

                <!-- Edit Button (only for own comments) -->
                {% if comment.is_own %}
                <button class="edit-comment-btn hover:text-indigo-600 text-sm font-medium">
                    Edit
                </button>
                {% endif %}

                <!-- Report Button -->
                <button class="report-btn hover:text-red-600 text-sm font-medium ml-auto">
                    <i class="fas fa-flag mr-1"></i> Report
                </button>
            </div>

            <!-- Reply Form (Hidden by default) -->
            <div class="reply-form hidden mt-4 pl-4 border-l-2 border-gray-200">
                <form class="space-y-3">
                    <textarea
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm"
                        rows="3"
                        placeholder="Write your reply..."
                        required
                    ></textarea>
                    <div class="flex justify-end space-x-3">
                        <button type="button" class="cancel-reply-btn px-4 py-2 text-sm text-gray-600 hover:text-gray-800">
                            Cancel
                        </button>
                        <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-sm font-medium">
                            Post Reply
                        </button>
                    </div>
                </form>
            </div>

            <!-- Edit Form (Hidden by default) -->
            <div class="edit-form hidden mt-4">
                <form class="space-y-3">
                    <textarea
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        rows="4"
                        required
                    >{{ comment.content }}</textarea>
                    <div class="flex justify-end space-x-3">
                        <button type="button" class="cancel-edit-btn px-4 py-2 text-sm text-gray-600 hover:text-gray-800">
                            Cancel
                        </button>
                        <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-sm font-medium">
                            Save Changes
                        </button>
                    </div>
                </form>
            </div>

            <!-- Replies Section -->
            {% if comment.replies and comment.replies.length > 0 %}
            <div class="replies mt-6 ml-4 pl-4 border-l-2 border-gray-100 space-y-4">
                {% for reply in comment.replies %}
                <!-- Nested Comment Component (reuse the same template) -->
                <div class="comment border-0 pb-4 mb-0">
                    <div class="flex items-start">
                        <a href="/profile/{{ reply.author.username }}/" class="flex-shrink-0">
                            <div class="w-8 h-8 rounded-full {{ reply.author.avatar_bg }} flex items-center justify-center">
                                <span class="{{ reply.author.avatar_text }} text-xs font-medium">{{ reply.author.initials }}</span>
                            </div>
                        </a>

                        <div class="ml-3 flex-1">
                            <div class="mb-1">
                                <a href="/profile/{{ reply.author.username }}/" class="font-medium text-sm hover:text-indigo-600">
                                    {{ reply.author.name }}
                                </a>
                                <span class="text-gray-400 text-xs ml-2">{{ reply.time_ago }}</span>
                            </div>
                            <p class="text-gray-600 text-sm">{{ reply.content }}</p>
                            <div class="mt-2 flex items-center space-x-3 text-gray-400 text-xs">
                                <button class="like-btn hover:text-indigo-600">
                                    <i class="far fa-thumbs-up mr-1"></i>
                                    <span>{{ reply.likes }}</span>
                                </button>
                                <button class="hover:text-indigo-600">Reply</button>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}

                <!-- View More Replies (if applicable) -->
                {% if comment.reply_count > comment.replies.length %}
                <button class="view-more-replies-btn text-sm text-indigo-600 hover:text-indigo-700 font-medium">
                    View {{ comment.reply_count - comment.replies.length }} more replies
                </button>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- JavaScript for Comment Interactions -->
<script>
    // Function to initialize comment functionality
    function initializeComment(commentElement) {
        // Like functionality
        const likeBtn = commentElement.querySelector('.like-btn');
        const likeCount = commentElement.querySelector('.like-count');

        if (likeBtn && likeCount) {
            likeBtn.addEventListener('click', function() {
                const isLiked = this.getAttribute('data-liked') === 'true';
                const icon = this.querySelector('i');
                let count = parseInt(likeCount.textContent);

                if (isLiked) {
                    // Unlike
                    this.setAttribute('data-liked', 'false');
                    icon.classList.remove('fas', 'text-indigo-600');
                    icon.classList.add('far');
                    likeCount.textContent = count - 1;
                } else {
                    // Like
                    this.setAttribute('data-liked', 'true');
                    icon.classList.remove('far');
                    icon.classList.add('fas', 'text-indigo-600');
                    likeCount.textContent = count + 1;
                }
            });
        }

        // Reply functionality
        const replyBtn = commentElement.querySelector('.reply-btn');
        const replyForm = commentElement.querySelector('.reply-form');
        const cancelReplyBtn = commentElement.querySelector('.cancel-reply-btn');

        if (replyBtn && replyForm) {
            replyBtn.addEventListener('click', function() {
                replyForm.classList.toggle('hidden');
            });
        }

        if (cancelReplyBtn && replyForm) {
            cancelReplyBtn.addEventListener('click', function() {
                replyForm.classList.add('hidden');
            });
        }

        // Edit functionality (only for own comments)
        const editBtn = commentElement.querySelector('.edit-comment-btn');
        const editForm = commentElement.querySelector('.edit-form');
        const cancelEditBtn = commentElement.querySelector('.cancel-edit-btn');
        const commentText = commentElement.querySelector('.comment-text');

        if (editBtn && editForm) {
            editBtn.addEventListener('click', function() {
                editForm.classList.remove('hidden');
                commentText.classList.add('hidden');
            });
        }

        if (cancelEditBtn && editForm) {
            cancelEditBtn.addEventListener('click', function() {
                editForm.classList.add('hidden');
                commentText.classList.remove('hidden');
            });
        }

        // Submit reply form
        const replyFormElement = commentElement.querySelector('.reply-form form');
        if (replyFormElement) {
            replyFormElement.addEventListener('submit', function(e) {
                e.preventDefault();
                const replyText = this.querySelector('textarea').value.trim();

                if (!replyText) return;

                // Show loading state
                const submitBtn = this.querySelector('button[type="submit"]');
                const originalText = submitBtn.textContent;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Posting...';
                submitBtn.disabled = true;

                // Simulate API call
                setTimeout(() => {
                    // Create new reply element
                    const repliesContainer = commentElement.querySelector('.replies') ||
                                           (() => {
                                               const container = document.createElement('div');
                                               container.className = 'replies mt-6 ml-4 pl-4 border-l-2 border-gray-100 space-y-4';
                                               commentElement.querySelector('.ml-4').appendChild(container);
                                               return container;
                                           })();

                    const newReply = document.createElement('div');
                    newReply.className = 'comment border-0 pb-4 mb-0';
                    newReply.innerHTML = `
                        <div class="flex items-start">
                            <a href="/profile/currentuser/" class="flex-shrink-0">
                                <div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center">
                                    <span class="text-indigo-600 text-xs font-medium">You</span>
                                </div>
                            </a>

                            <div class="ml-3 flex-1">
                                <div class="mb-1">
                                    <a href="/profile/currentuser/" class="font-medium text-sm hover:text-indigo-600">
                                        You
                                    </a>
                                    <span class="text-gray-400 text-xs ml-2">Just now</span>
                                </div>
                                <p class="text-gray-600 text-sm">${replyText}</p>
                                <div class="mt-2 flex items-center space-x-3 text-gray-400 text-xs">
                                    <button class="like-btn hover:text-indigo-600">
                                        <i class="far fa-thumbs-up mr-1"></i>
                                        <span>0</span>
                                    </button>
                                    <button class="hover:text-indigo-600">Reply</button>
                                </div>
                            </div>
                        </div>
                    `;

                    repliesContainer.appendChild(newReply);
                    initializeComment(newReply);

                    // Reset form
                    this.reset();
                    replyForm.classList.add('hidden');

                    // Reset button
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;

                    // Update "View more replies" if exists
                    const viewMoreBtn = commentElement.querySelector('.view-more-replies-btn');
                    if (viewMoreBtn) {
                        const currentText = viewMoreBtn.textContent;
                        const match = currentText.match(/\d+/);
                        if (match) {
                            const count = parseInt(match[0]) - 1;
                            if (count > 0) {
                                viewMoreBtn.textContent = `View ${count} more replies`;
                            } else {
                                viewMoreBtn.remove();
                            }
                        }
                    }
                }, 1000);
            });
        }

        // Submit edit form
        const editFormElement = commentElement.querySelector('.edit-form form');
        if (editFormElement) {
            editFormElement.addEventListener('submit', function(e) {
                e.preventDefault();
                const newText = this.querySelector('textarea').value.trim();

                if (!newText) return;

                // Show loading state
                const submitBtn = this.querySelector('button[type="submit"]');
                const originalText = submitBtn.textContent;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Saving...';
                submitBtn.disabled = true;

                // Simulate API call
                setTimeout(() => {
                    // Update comment text
                    commentText.querySelector('p').textContent = newText;

                    // Show edited indicator
                    const timeAgo = commentElement.querySelector('.text-gray-500.text-sm');
                    if (timeAgo) {
                        const editedSpan = document.createElement('span');
                        editedSpan.className = 'text-gray-400 text-sm ml-1';
                        editedSpan.textContent = '(edited)';
                        timeAgo.parentNode.insertBefore(editedSpan, timeAgo.nextSibling);
                    }

                    // Hide edit form, show comment
                    editForm.classList.add('hidden');
                    commentText.classList.remove('hidden');

                    // Reset button
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                }, 800);
            });
        }

        // Report functionality
        const reportBtn = commentElement.querySelector('.report-btn');
        if (reportBtn) {
            reportBtn.addEventListener('click', function() {
                const commentId = commentElement.getAttribute('data-comment-id');
                const reason = prompt('Please enter the reason for reporting this comment:');

                if (reason) {
                    // Simulate API call
                    alert('Thank you for your report. We will review this comment shortly.');
                }
            });
        }

        // View more replies
        const viewMoreBtn = commentElement.querySelector('.view-more-replies-btn');
        if (viewMoreBtn) {
            viewMoreBtn.addEventListener('click', function() {
                const commentId = commentElement.getAttribute('data-comment-id');

                // Simulate loading more replies
                this.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Loading...';

                setTimeout(() => {
                    // Add more replies
                    const repliesContainer = commentElement.querySelector('.replies');
                    // In a real app, this would be an API call to fetch more replies

                    // Remove the button since we've loaded all
                    this.remove();
                }, 1000);
            });
        }
    }

    // Initialize all comments on page load
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.comment').forEach(initializeComment);
    });
</script>

</body>
</html>